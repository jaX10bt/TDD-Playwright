name: Complete User Management Functionality Tests

tests:
  - name: Sorting and Searching by Keywords
    serial: true
    steps:
      - name: Before Each Setup
        action:
          goto: "https://admin.prod.buerokratt.ee/chat/users"
          waitFor: networkidle

      - name: Fetch Translations
        action:
          getTranslations: true
          assignVariable: 
            translations: "{{ await getTranslations }}"

      - name: Sorting and Searching by Columns
        action:
          testSorting:
            columns:
              - "{{ translations['name'] }}"
              - "{{ translations['idCode'] }}"
              - column: "{{ translations['role'] }}"
                annotation:
                  type: Known bug
                  description: "The sorting starts from Z-A for some reason instead of A-Z as with other sortings."
              - "{{ translations['displayName'] }}"
              - "{{ translations['userTitle'] }}"
              - "{{ translations['e-mail'] }}"
          testSearching:
            columns:
              - "{{ translations['name'] }}"
              - "{{ translations['idCode'] }}"
              - "{{ translations['role'] }}"
              - "{{ translations['displayName'] }}"
              - "{{ translations['userTitle'] }}"
              - "{{ translations['e-mail'] }}"
              - "{{ translations['role'] }}"



  - name: User Management Functionality Tests for user creation, editing, and deletion
    serial: true
    steps:
      - name: Before Each Setup
        action: goto
        url: "https://admin.prod.buerokratt.ee/chat/users"
        waitFor: networkidle

      - name: Add a new user
        action:
          click: "{{ translations['addUser'] }}"
          form:
            fullName: "Test User"
            idCode: "EE12345678910"
            role: "administrator"
            displayName: "TUser"
            title: "Developer"
            email: "test.user@example.com"
          verify: "Test User"
      
      - name: Edit user details
        action:
          findRow: "Test User"
          click: "{{ translations['edit'] }}"
          form:
            fullName: "Edited User"
            displayName: "EUser"
            title: "Senior Developer"
            email: "edited.user@example.com"
            roleUpdate:
              remove: "administrator"
              add: "serviceManager"
          verify: "Edited User"
      
      - name: Delete user
        action:
          findRow: "Edited User"
          click: "{{ translations['delete'] }}"
          confirm: "{{ translations['yes'] }}"
          verify: not "Edited User"
